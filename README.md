Contract Address (Testnet deloyment): 0x454f1cdaf772161f9ca6177ae5f6feda6e65c18f40c5e319aca891c959c92e70

# Random Meal Picker ‚Äì Random meal picker for groups

A simple dApp that helps a group randomly pick a meal.  
The frontend is built with **Next.js + React + TypeScript**, and the smart contract is written in **IOTA Move** and deployed on an IOTA network (devnet/testnet).

---

## Features

- Connect to an **IOTA wallet** using `@iota/dapp-kit`.
- Let the user enter a numeric **seed** and call the Move function `pick_random`.
- The contract computes a pseudo-random index and creates a **`MealChoice`** object on-chain.
- The frontend:
  - Maps the index to a fixed list of meals (Sushi, Pizza, Burger, Ph·ªü, Salad, Curry).
  - Shows the chosen meal, the on-chain object ID, and the **transaction hash**.
- Remembers the last `MealChoice` for each wallet address using `localStorage`.

---

## Tech Stack

### Frontend

- **Next.js** (App Router, React, TypeScript)
- **@iota/dapp-kit** ‚Äì wallet connection and RPC client
- **@iota/iota-sdk** ‚Äì client & transaction builder
- **@radix-ui/themes** ‚Äì UI components

### Smart Contract

- **Language:** IOTA Move
- **Module name:** `meal_picker`
- **Main entry function:** `pick_random(meal_count: u64, seed: u64, ctx: &mut TxContext)`
- **On-chain object:** `MealChoice` (stores chosen index, seed, and user address)

---

## Project Structure

```txt
random-meal-picker/
‚îú‚îÄ app/
‚îÇ  ‚îú‚îÄ layout.tsx           # Root layout ‚Äì wraps app with IOTA & UI providers
‚îÇ  ‚îî‚îÄ page.tsx             # Main page ‚Äì renders the Random Meal Picker UI
‚îú‚îÄ components/
‚îÇ  ‚îú‚îÄ Provider.tsx         # IotaClientProvider + WalletProvider setup
‚îÇ  ‚îî‚îÄ sample.tsx           # Main Random Meal Picker React component
‚îú‚îÄ contract/
‚îÇ  ‚îî‚îÄ random_meal_picker/
‚îÇ     ‚îú‚îÄ Move.toml         # Move package definition
‚îÇ     ‚îî‚îÄ sources/
‚îÇ        ‚îî‚îÄ meal_picker.move   # Move module with `pick_random`
‚îú‚îÄ hooks/
‚îÇ  ‚îî‚îÄ useContract.ts       # React hook to call `pick_random` and read MealChoice
‚îú‚îÄ lib/
‚îÇ  ‚îî‚îÄ config.ts            # Network + package IDs (DEVNET / TESTNET)
‚îú‚îÄ prompts/
‚îÇ  ‚îî‚îÄ prompt_*.md          # AI customization prompts generated by deploy script
‚îú‚îÄ public/                 # Static assets
‚îú‚îÄ scripts/
‚îÇ  ‚îî‚îÄ iota-deploy-wrapper.js  # Helper script to build & publish Move contract
‚îú‚îÄ INSTRUCTION_GUIDE.md    # Workshop instruction notes
‚îú‚îÄ README.md               # Project description (this file)
‚îú‚îÄ package.json
‚îî‚îÄ tsconfig.json

# 1. Requirements

Make sure you have:

- Node.js >= 20.9.0
- npm (comes with Node.js)
- IOTA CLI (iota binary) installed and configured
- An IOTA wallet (e.g. browser extension) that can connect via dApp Kit
- Access to devnet or testnet (depending on how you deploy)

---

# 2. Installation & Local Development

## 2.1. Clone the repository

```bash
git clone https://github.com/21011612/Random-Meal-Picker.git
cd Random-Meal-Picker
```

## 2.2. Install dependencies

```bash
npm install
# or, if needed:
# npm install --legacy-peer-deps
```

## 2.3. Start the Next.js dev server

```bash
npm run dev
```

The app will start on:

```
http://localhost:3000
```

Open this URL in your browser and connect your IOTA wallet.

---

# 3. Smart Contract (Move) ‚Äì meal_picker

The Move contract is located at:

```
contract/random_meal_picker/sources/meal_picker.move
```

## 3.1. Module & Types

**Module:** `random_meal_picker::meal_picker`

### Main struct:

```move
public struct MealChoice has key, store {
    id: UID,
    index: u64,
    seed: u64,
    user: address,
}
```

### Entry function:

```move
public fun pick_random(
    meal_count: u64,
    seed: u64,
    ctx: &mut tx_context::TxContext
) { /* ... */ }
```

### The contract:

- Uses meal_count (number of meals on frontend) and a numeric seed.
- Computes a pseudo-random number based on seed.
- Calculates index = random_value % meal_count.
- Creates a MealChoice object with { index, seed, user } and transfers it to the sender.

---

# 4. Deploying the Move Contract

This project comes with a helper script that builds and publishes the Move package to an IOTA network (devnet/testnet).

From the project root:

```bash
npm run iota-deploy
```

You will be prompted for:

- Network ‚Äì choose devnet or testnet.
- Address ‚Äì continue with an existing address or create a new one.

The script:

- Builds the Move package under contract/random_meal_picker.
- Publishes it to the chosen IOTA network.
- Prints the Package ID.
- Updates lib/config.ts with the new package ID for the selected network.
- Updates INSTRUCTION_GUIDE.md and (if possible) integration hints.

After deployment, note:

- The Package ID (shown at the end of the script).
- The network where it was deployed (devnet/testnet).

---

# 5. Frontend Integration (React / Next.js)

## 5.1. Providers

In app/layout.tsx and components/Provider.tsx, the app is wrapped with:

- IotaClientProvider
- WalletProvider
- Theme from @radix-ui/themes

These providers:

- Configure the IOTA JSON-RPC endpoint.
- Manage wallet connection state.
- Provide styling and consistent UI theme.

---

## 5.2. Contract Hook ‚Äì hooks/useContract.ts

useContract.ts centralizes all contract logic.

### Configuration:

```ts
export const CONTRACT_PACKAGE_ID = "<your-package-id>"; // updated by iota-deploy
export const CONTRACT_MODULE = "meal_picker";
export const CONTRACT_METHODS = {
  PICK_RANDOM: "pick_random",
} as const;
```

### Data shape from chain:

```ts
export interface ContractData {
  index: number;
  seed: number;
  user: string;
}
```

### Key responsibilities:

Build a transaction:

```ts
tx.moveCall({
  arguments: [tx.pure.u64(mealCount), tx.pure.u64(seed)],
  target: `${packageId}::${CONTRACT_MODULE}::${CONTRACT_METHODS.PICK_RANDOM}`,
});
```

Use useSignAndExecuteTransaction to sign and submit.

Wait for confirmation via `iotaClient.waitForTransaction`.

Extract the created MealChoice object ID.

Store `mealChoiceId_<address>` in localStorage.

Fetch the object later using:

```ts
useIotaClientQuery("getObject", ...)
```

### Returned values:

```ts
{
  data,
  actions: {
    pickRandomMeal(mealCount, seed),
    clearChoice(),
  },
  state: {
    isLoading,
    isPending,
    isConfirming,
    isConfirmed,
    hash,
    error,
  },
  choiceId,
  objectExists,
  hasValidData,
  isFetching,
}
```

---

## 5.3. UI Component ‚Äì components/sample.tsx

Main Random Meal Picker UI:

- Checks wallet connection with useCurrentAccount().
- If not connected ‚Üí show message.
- If connected:

  - Meal list (index + emoji)
  - Numeric seed input
  - ‚Äúüé≤ Pick Meal‚Äù button
  - If MealChoice exists:
    - meal
    - index
    - seed
    - MealChoice ID
  - transaction hash
  - confirmation status
  - errors

---

# 6. How to Run the dApp Locally

## Install dependencies

```bash
npm install
```

## (Optional) Deploy contract

```bash
npm run iota-deploy
```

Choose a network.  
Wait for script to complete.  
Ensure `lib/config.ts` contains updated PACKAGE_ID.

## Start the dev server

```bash
npm run dev
```

## Open the app

```
http://localhost:3000
```

Connect your IOTA wallet via dApp Kit.  
Enter any seed ‚Üí press ‚Äúüé≤ Pick Meal‚Äù.

The frontend will display:

- Chosen meal
- MealChoice on-chain ID
- Transaction hash
